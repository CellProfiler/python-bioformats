language: java
env:
- PYTHON_VERSION="2.7"
before_install:
- if [ -z $TRAVIS_TAG ]; then TRAVIS_TAG=`git tag --contains` ; fi
- echo $TRAVIS_TAG
- cd ../..
- pwd
install:
- wget http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh
- bash miniconda.sh -b -p $HOME/miniconda
- export PATH="$HOME/miniconda/bin:$PATH"
- conda config --set always_yes yes
- conda config --set show_channel_urls True
- source activate root
- touch $HOME/miniconda/conda-meta/pinned
- echo "conda-build ==1.16.0" >> $HOME/miniconda/conda-meta/pinned
- conda update --all
- conda install conda-build
- cd $TRAVIS_REPO_SLUG
- conda create --use-local -n testenv python=$PYTHON_VERSION
- source activate testenv
- conda install numpy
- python setup.py install
- conda install sphinx
- echo "coverage 3.*" >> $HOME/miniconda/envs/testenv/conda-meta/pinned
- conda install nose
- conda install coverage
- pip install coveralls
- conda clean -tipsy
- rm -rfv $HOME/.cache/pip
script:
- python nosetests.py
- cd docs
- make html
- cd ..
sudo: false
deploy:
  on:
     repo: CellProfiler/python-bioformats
     tags: true
  provider: pypi
  skip_cleanup: true
  user: "Lee.Kamentsky"
  password:
    secure: fbj2t8kHtIevCtC34mBYGENSP6OICP4c0xsxlxNdk/G61EJRBHY92pPH9NUN10bXiPtGiXm4wOR4yrWuqrhP1C3BXjSrR8+FJudvhnMkjwFxKMrIZX1TpJ7Zp/4yHZ6Ui+2YTmKyWbk+61reByhlWV+03ZwInvFFg6E6h11s9Bo=
